/**********************************************************************************************************************************************************
 *
                          _____                                   _____                               _                     
                         / ____|                                 |_   _|                             | |                    
                        | (___    _ __     __ _    ___    ___      | |    _ __   __   __   __ _    __| |   ___   _ __   ___ 
                         \___ \  | '_ \   / _` |  / __|  / _ \     | |   | '_ \  \ \ / /  / _` |  / _` |  / _ \ | '__| / __|
                         ____) | | |_) | | (_| | | (__  |  __/    _| |_  | | | |  \ V /  | (_| | | (_| | |  __/ | |    \__ \
                        |_____/  | .__/   \__,_|  \___|  \___|   |_____| |_| |_|   \_/    \__,_|  \__,_|  \___| |_|    |___/
                                 | |                                                                                        
                                 |_|                                                
 * 
 ***********************************************************************************************************************************************************
*   
*
 **********************************************************************************************************************************************************/


#include <stdio.h>
#include <stdint.h>
#include <pthread.h>
#include "utilidades.h"
#include "menues.h"

#define RASPI


/*******************************************************************************************************************************************
 * 
                                 _____   _                          _           ___           _              
                                |_   _| (_)  _ __   ___   ___    __| |  ___    |   \   __ _  | |_   ___   ___
                                  | |   | | | '_ \ / _ \ (_-<   / _` | / -_)   | |) | / _` | |  _| / _ \ (_-<
                                  |_|   |_| | .__/ \___/ /__/   \__,_| \___|   |___/  \__,_|  \__| \___/ /__/
                                            |_|                                                          
 * 
 ******************************************************************************************************************************************/


/*******************************************************************************************************************************************
*******************************************************************************************************************************************/


/*******************************************************************************************************************************************
 * 
                                             __  __                              
                                            |  \/  |  __ _   __   _ _   ___   ___
                                            | |\/| | / _` | / _| | '_| / _ \ (_-<
                                            |_|  |_| \__,_| \__| |_|   \___/ /__/                                                    
 * 
 ******************************************************************************************************************************************/

#ifdef RASPI
#define SIGUIENTE ((*(menu->keys))->x == 1)
#define ANTERIOR  ((*(menu->keys))->x == -1)
#endif

#ifdef ALLEGRO
#define SIGUIENTE ((*(menu->keys))->y == 1)
#define ANTERIOR  ((*(menu->keys))->y == -1)
#endif

#define PRESS     ((*(menu->keys))->press == 1)
/*******************************************************************************************************************************************
*******************************************************************************************************************************************/


/*******************************************************************************************************************************************
 * 
                                     ___                     _                   _              
                                    / __|  ___   _ _    ___ | |_   __ _   _ _   | |_   ___   ___
                                   | (__  / _ \ | ' \  (_-< |  _| / _` | | ' \  |  _| / -_) (_-<
                                    \___| \___/ |_||_| /__/  \__| \__,_| |_||_|  \__| \___| /__/
                                                                                                                                                            
 * 
 ******************************************************************************************************************************************/

enum PANTALLAS { MENU_INICIO , IN_GAME , MENU_PAUSA , MENU_VOLUMEN , MENU_LOST };//Determinan un valor para cada pantalla
/*******************************************************************************************************************************************
*******************************************************************************************************************************************/


/*******************************************************************************************************************************************
 * 
                __   __               _          _      _                 ___   _         _             _            
                \ \ / /  __ _   _ _  (_)  __ _  | |__  | |  ___   ___    / __| | |  ___  | |__   __ _  | |  ___   ___
                 \ V /  / _` | | '_| | | / _` | | '_ \ | | / -_) (_-<   | (_ | | | / _ \ | '_ \ / _` | | | / -_) (_-<
                  \_/   \__,_| |_|   |_| \__,_| |_.__/ |_| \___| /__/    \___| |_| \___/ |_.__/ \__,_| |_| \___| /__/
                                                                                                                                                            
 * 
 ******************************************************************************************************************************************/

gameStatus_t GAME_STATUS = { .pantallaActual = MENU_INICIO, .nivelActual = 0 , .exitStatus = 1};

keys_t KEYS = { .x =0, .y = 0, .press = 0 };//Almacena las teclas presionadas por el usuario.

sem_t SEM_GAME;//Semaforo que regula la ejecucion de los niveles.
/*******************************************************************************************************************************************
*******************************************************************************************************************************************/


/*******************************************************************************************************************************************
 * 
                                                         __  __          _        
                                                        |  \/  |  __ _  (_)  _ _  
                                                        | |\/| | / _` | | | | ' \ 
                                                        |_|  |_| \__,_| |_| |_||_|
                                                                                                                                                            
 * 
 ******************************************************************************************************************************************/

int main(void){

    pthread_t menuHandlerT, levelHandlerT;

    while(GAME_STATUS.exitStatus){//El juego se ejecuta hasta que se indique lo contrario en exitStatus.

        switch(GAME_STATUS.pantallaActual){//Esta seccion del codigo se encarga de inicializar los threads correctos dependiendo de la pantalla
                                           //actual y de la opcion seleccionada en algun menu.
            case MENU_INICIO:
                pthread_create(&menuHandlerT, NULL, menuHandlerThread, NULL);


            default:
                break;
        }
    }

    return 0;
}
/*******************************************************************************************************************************************
*******************************************************************************************************************************************/





static void* menuHandlerThread(void * data){

	menu_t * menu = (menu_t *) data;

    int select = 0;

    while(menu -> exitStatus){

        if (SIGUIENTE){
            //Animacion
            select += 1;
            if(menu->selectOption[select] == NULL){
                select = 0;
            }
            (menu -> changeOption)(1);
        }

        if (ANTERIOR){
            //Animacion
            select -= 1;
            if(select < 0){
                select = (menu -> cantOpciones) - 1;
            }
            (menu -> changeOption)(-1);
        }

        if (PRESS){
            menu -> exitStatus = (menu->selectOption[select])();
        }
    }
    
    pthread_exit(0);
}

//Reset

    //Salir al nivel reseteado

//Resume

    //Salir al nivel

//Volume

    //Salir al menu de volumen

//Home

    //Salir al menu principal

//Score

    //Mostrar en pantalla el puntaje

/*

    thread (handler)
    struct de los datos de thread
    punteros para mostrar las cosas




static void* levelHandler(void * data){

	menu_t * menu = (menu_t *) data;

	opcion_t * opcionActual = menu->opciones[0];

	if (DISPARAR){
		//Animacion
		disparar();
	}

	if (MOVDERECHA){
		//Animacion
		moverder();
	}

	if (PRESS){
		*opcionActual();
	}

}

*/